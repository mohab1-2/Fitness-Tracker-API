{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Fitness Tracker{% endblock %}

{% block content %}
<div class="card">
    <div class="d-flex justify-between align-center mb-3">
        <h1>Welcome back, {{ user.username }}!</h1>
        <a href="{% url 'add_activity' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Activity
        </a>
    </div>
    
    <!-- Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number" id="totalActivities">{{ stats.total_activities|default:"0" }}</div>
            <div class="stat-label">Total Activities</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="totalDuration">{{ stats.total_duration|default:"0" }}m</div>
            <div class="stat-label">Total Duration</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="totalDistance">{{ stats.total_distance|default:"0" }}km</div>
            <div class="stat-label">Total Distance</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="totalCalories">{{ stats.total_calories|default:"0" }}</div>
            <div class="stat-label">Calories Burned</div>
        </div>
    </div>
</div>

<div class="grid grid-2">
    <!-- Recent Activities -->
    <div class="card">
        <div class="d-flex justify-between align-center mb-3">
            <h2>Recent Activities</h2>
            <a href="{% url 'activities' %}" class="btn btn-secondary">View All</a>
        </div>
        
        <div id="recentActivities">
            {% if recent_activities %}
                {% for activity in recent_activities %}
                <div class="activity-card mb-2">
                    <div class="d-flex justify-between align-center">
                        <div>
                            <span class="activity-type {{ activity.activity_type }}">{{ activity.activity_type }}</span>
                            <h3 class="mb-2">{{ activity.duration }} minutes</h3>
                            <p class="text-muted">
                                <i class="fas fa-route"></i> {{ activity.distance }} km | 
                                <i class="fas fa-fire"></i> {{ activity.calories_burned }} cal
                            </p>
                        </div>
                        <div class="text-right">
                            <small class="text-muted">{{ activity.date|date:"M d, Y" }}</small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="text-center text-muted">
                    <i class="fas fa-running" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                    <p>No activities yet. Start your fitness journey!</p>
                    <a href="{% url 'add_activity' %}" class="btn btn-primary">Add Your First Activity</a>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Activity Trends -->
    <div class="card">
        <h2>This Week's Progress</h2>
        <div id="weeklyChart" style="height: 300px; margin-top: 1rem;">
            <canvas id="weeklyProgressChart"></canvas>
        </div>
    </div>
</div>

<!-- Activity Type Distribution -->
<div class="card">
    <h2>Activity Distribution</h2>
    <div class="grid grid-3" id="activityDistribution">
        {% for item in activity_distribution %}
        <div class="stat-card">
            <div class="stat-number">{{ item.count }}</div>
            <div class="stat-label">{{ item.activity_type|title }}</div>
        </div>
        {% empty %}
        <div class="text-center text-muted">
            <p>No activities to show distribution</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}
